'use strict';

var ut2 = require('ut2');
var native = require('./utils/native.js');

function loadImage(img) {
    return new Promise(function (resolve, reject) {
        var imgIsBlob = ut2.isBlob(img);
        var url = imgIsBlob ? native.createObjectURL(img) : img;
        var image = new Image();
        if (!imgIsBlob) {
            image.crossOrigin = 'anonymous';
        }
        image.onload = function () {
            resolve(image);
        };
        image.onerror = function (err) {
            if (imgIsBlob) {
                native.revokeObjectURL(url);
            }
            console.error("[loadImage] The image load failed, '".concat(img, "'."));
            reject(err);
        };
        image.src = url;
    });
}

module.exports = loadImage;
